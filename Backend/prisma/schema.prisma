
generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id        Int     @id @default(autoincrement())
    email     String  @unique
    password  String?
    verified  Boolean @default(false)

    role      String  @default("user")

    // Provider
    provider String @default("local")
    googleId String? @unique

    // Relation
    verificationCodes VerificationCode[]

    // Timestamps
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("users")
}

model VerificationCode {
    id        Int      @id @default(autoincrement())
    userId    Int
    code      String   @unique
    type String @default("email_verification")
    expiresAt DateTime

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([userId, type]) // NEW: Prevent multiple codes
    @@map("verification_codes")
}
